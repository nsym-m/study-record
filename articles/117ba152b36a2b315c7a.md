---
title: "ã€Flutterã€‘Riverpodã§BottomNavigationBar"
emoji: "ğŸ’­"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["flutter", "Riverpod"]
published: false
---

# ã¯ã˜ã‚ã«
ã“ã‚“ã«ã¡ã¯ã€‚ã«ã—ã‚„ã¾ã§ã™ã€‚

æœ€è¿‘ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã§ã¯Flutterã‚’è§¦ã£ã¦ã¿ã¦ã„ã¾ã™ã€‚
åŒã˜ã‚ˆã†ãªã“ã¨ã‚’ã—ã¦ã„ã‚‹è¨˜äº‹ã¯ä»–ã«ã‚‚ã„ãã¤ã‹ã‚ã‚‹ã®ã§ã™ãŒã€å°‘ã—ãƒãƒã£ãŸã¨ã“ã‚ãŒã‚ã£ãŸã®ã§è¨˜äº‹ã«ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚
BottomNavigationBarã¨ã¯ã€ã‚¢ãƒ—ãƒªç”»é¢ä¸‹éƒ¨ã®ã‚¿ãƒ–ã‚’ä½œã‚‹éƒ¨å“ã§ã™ã€‚

ãªãŠã€Riverpodã«ã¤ã„ã¦è©³ã—ãçŸ¥ã‚ŠãŸã„æ–¹ã¯[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://riverpod.dev/)ã‚’ã”è¦§ãã ã•ã„ã€‚
æ—¥æœ¬èªã«ã‚‚åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã¦è‹±èªã®èª­ã‚ãªã„æ„šã‹ãªåƒ•ã«ã‚‚è¦ªåˆ‡ã§å¬‰ã—ã„ã§ã™ã€‚ï¼ˆè‹±èªå‹‰å¼·ã—ãªãã‚ƒ...ï¼‰

# å®Ÿéš›ã®å‹•ä½œ
å‹•ä½œã•ã›ã¦ã„ã‚‹æ§˜å­ãŒã“ã¡ã‚‰ã«ãªã‚Šã¾ã™ã€‚
ï¼ˆã¡ã‚‡ã£ã¨ç”»è³ªè’ã„ã§ã™ãŒ...ï¼‰
![base_tab_view.gif](/images/flutter-riverpod-bottomnavifgationbar/base_tab_view.gif)


# ç’°å¢ƒ

```bash
$ flutter --version
Flutter 2.10.4 â€¢ channel stable â€¢ https://github.com/flutter/flutter.git
Framework â€¢ revision c860cba910 (6 weeks ago) â€¢ 2022-03-25 00:23:12 -0500
Engine â€¢ revision 57d3bac3dd
Tools â€¢ Dart 2.16.2 â€¢ DevTools 2.9.2
```
pubspec.yaml
```yaml
flutter_riverpod: ^1.0.3
```

# ã‚³ãƒ¼ãƒ‰

å¤§ã—ãŸã“ã¨ã¯ã—ã¦ã„ã¾ã›ã‚“ãŒã‚³ãƒ¼ãƒ‰ã‚’è¼‰ã›ãŸå¾Œã§ç°¡å˜ã«è§£èª¬ã—ã¾ã™ã€‚

### main.dart
```dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:sample/views/base_tab_view.dart';

void main() {
  // ProviderScopeã§å›²ã‚€ã“ã¨ã§riverpodã‚’åˆ©ç”¨
  runApp(const ProviderScope(child: MyApp()));
}

class MyApp extends StatelessWidget {
  const MyApp({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'test',
      theme: ThemeData(
        primarySwatch: Colors.blue,
      ),
      // BottomNavigationBarã‚’å®Ÿè£…ã—ãŸã‚¢ãƒ—ãƒªã®baseã¨ãªã‚‹viewã‚’åˆ©ç”¨
      home: BaseTabView(),
    );
  }
}
```
main.dartã¯ã‚³ãƒ¡ãƒ³ãƒˆä»¥ä¸Šã®è§£èª¬ã¯ä¸è¦ã‹ã¨æ€ã„ã¾ã™ã®ã§çœãã¾ã™ã€‚

### views/home_view.dart
```dart
import 'package:flutter/material.dart';

class HomeView extends StatelessWidget {
  const HomeView({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return const Scaffold(
      body: Center(
        child: Icon(
          Icons.home,
        ),
      ),
    );
  }
}
```
ã“ã¡ã‚‰ã¯ã‚µãƒ³ãƒ—ãƒ«ã®ç‚ºã®ç°¡å˜ãªç”»é¢ã§ã™ã€‚
ã‚¢ã‚¤ã‚³ãƒ³ã¨ã‚¯ãƒ©ã‚¹åã¨ãƒ•ã‚¡ã‚¤ãƒ«åã ã‘å¤‰ãˆãŸã‚‚ã®ã‚’home, info, helpã¨ç”¨æ„ã—ã¾ã—ãŸã€‚

### views/base_tab_view.dart
```dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:sample/views/help_view.dart';
import 'package:sample/views/home_view.dart';
import 'package:sample/views/info_view.dart';

final baseTabViewProvider = StateProvider<ViewType>((ref) => ViewType.home);

enum ViewType { home, info, help }

class BaseTabView extends ConsumerWidget {
  BaseTabView({Key? key}) : super(key: key);

  final widgets = [
    const HomeView(),
    const InfoView(),
    const HelpView(),
  ];

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final view = ref.watch(baseTabViewProvider.state);
    return Scaffold(
      appBar: AppBar(title: Text(view.state.name)),
      body: widgets[view.state.index],
      bottomNavigationBar: BottomNavigationBar(
        items: const [
          BottomNavigationBarItem(icon: Icon(Icons.home), label: 'home'),
          BottomNavigationBarItem(icon: Icon(Icons.info), label: 'info'),
          BottomNavigationBarItem(icon: Icon(Icons.help), label: 'help'),
        ],
        currentIndex: view.state.index,
        onTap: (int index) => view.update((state) => ViewType.values[index]),
        type: BottomNavigationBarType.fixed,
      ),
    );
  }
}
```

# è§£èª¬

`base_tab_view.dart`ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚

```dart
final baseTabViewProvider = StateProvider<ViewType>((ref) => ViewType.home);
```
â†’ StateProviderã¯ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¹ãƒ†ãƒ¼ãƒˆï¼ˆçŠ¶æ…‹ï¼‰ã‚’ç®¡ç†ã™ã‚‹éš›ã«ä½¿ã‚ã‚Œã¾ã™ã€‚
[Riverpodã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://riverpod.dev/ja/docs/providers/state_provider)ã«ã¯StateProviderã‚’ä½¿ã†ã¹ãã§ã¯ãªã„ç›®å®‰ã¨ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚
> é€†ã«è¨€ãˆã°ã€StateProvider ã¯æ¬¡ã®ã‚ˆã†ãªã‚¹ãƒ†ãƒ¼ãƒˆã‚’å…¬é–‹ã™ã‚‹ãŸã‚ã«ä½¿ã†ã¹ãã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
> - ã‚¹ãƒ†ãƒ¼ãƒˆã®ç®—å‡ºã«ä½•ã‹ã—ã‚‰ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ¤œè¨¼ï¼‰ãƒ­ã‚¸ãƒƒã‚¯ãŒå¿…è¦
> - ã‚¹ãƒ†ãƒ¼ãƒˆè‡ªä½“ãŒè¤‡é›‘ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚‹ï¼ˆã‚«ã‚¹ã‚¿ãƒ ã®ã‚¯ãƒ©ã‚¹ã‚„ List/Map ãªã©ï¼‰
> - ã‚¹ãƒ†ãƒ¼ãƒˆã‚’å¤‰æ›´ã™ã‚‹ãŸã‚ã®ãƒ­ã‚¸ãƒƒã‚¯ãŒå˜ç´”ãª count++ ã‚ˆã‚Šã¯é«˜åº¦ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹

ä»Šå›ã¯ã©ã‚Œã‚‚æº€ãŸã•ãªã„ã”ãå˜ç´”ãªã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç†ãªã®ã§StateProviderã‚’ç”¨ã„ã¦ã„ã¾ã™ã€‚

StateProviderã®å®£è¨€æ™‚ã«`ViewType`ã®`home`ã‚’è¿”ã—ã¦ã„ã‚‹ã“ã¨ã«ã¯ã„ãã¤ã‹ç†ç”±ãŒã‚ã‚Šã¾ã™ã€‚
- ã‚¿ãƒ–ã®åˆæœŸä½ç½®ã¯homeå›ºå®šã®ç‚º
- ã‚¿ãƒ–ã®ãƒªã‚¹ãƒˆã¯enumã§ç®¡ç†ã—ãªãã¦ã‚‚åˆ‡ã‚Šæ›¿ãˆå¯èƒ½ã ãŒã€ç¨®é¡ã‚’æ˜ç¤ºçš„ã«ã™ã‚‹ç‚º

```dart
class BaseTabView extends ConsumerWidget {
```
â†’ flutter_riverpodã¨ã—ã¦æ‰±ã†ç‚ºã«ã¯ConsumerWidgetã‚’extendsã—ã¾ã™ã€‚
ConsumerWidgetã¯`Widget build(BuildContext context, WidgetRef ref)`ã¨ã—ã¦WidgetRefã‚’å–å¾—ã§ãã‚‹ã“ã¨ä»¥å¤–ã¯ã»ã¨ã‚“ã©StatelessWidgetã¨åŒã˜ã§ã™ã€‚

```dart
final widgets = [
  const HomeView(),
  const InfoView(),
  const HelpView(),
];
```
â†’ bodyã«æ¸¡ã™å®Ÿéš›ã«è¡¨ç¤ºã•ã›ãŸã„Widgetã‚’Listã§å®šç¾©ã—ã¾ã™ã€‚

```dart
final view = ref.watch(baseTabViewProvider.state);
```
â†’ ã“ã“ã§"state"ã‚’æ¸¡ã—ã¦ã‚ã’ãªã„ã¨viewãŒbaseTabViewProviderã®å¤‰æ›´ã‚’listenã—ã¦ãã‚Œãªã„ç‚ºã‚¿ãƒ–ãŒã‚¿ãƒƒãƒ—ã•ã‚Œã¦ã‚‚ç”»é¢ãŒé·ç§»ã—ãªã„ç¾è±¡ãŒç™ºç”Ÿã—ã¾ã™ã€‚
ï¼ˆ`ref.watch(baseTabViewProvider.notifier);`ã¨æ›¸ã„ã¦ã—ã¾ã£ã¦ç”»é¢é·ç§»ã›ãšã—ã°ã‚‰ããƒãƒã£ã¦ã—ã¾ã„ã¾ã—ãŸï¼‰

- `ref.watch(baseTabViewProvider.state)`: StateNotifierã‚’å–å¾—ã—ã‚¹ãƒ†ãƒ¼ãƒˆã‚’listenã™ã‚‹
- `ref.watch(baseTabViewProvider.notifier)`: StateNotifierã‚’å–å¾—ã™ã‚‹ã ã‘ã§ã‚¹ãƒ†ãƒ¼ãƒˆã®listenã¯ã—ãªã„

```dart
body: widgets[view.state.index],
```
ãã®æ™‚é¸æŠã•ã‚Œã¦ã„ã‚‹ã‚¹ãƒ†ãƒ¼ãƒˆã«ã‚ˆã£ã¦æ¸¡ã•ã‚Œã‚‹WidgetãŒå¤‰ã‚ã‚Šã¾ã™ã€‚
ã‚¿ãƒ–ãŒã‚¿ãƒƒãƒ—ã•ã‚Œã‚¹ãƒ†ãƒ¼ãƒˆã®å€¤ãŒå¤‰ã‚ã‚‹åº¦ã«ç”»é¢ãŒå†æç”»ã•ã‚Œã¾ã™ã€‚

```dart
bottomNavigationBar: BottomNavigationBar(
  items: const [
    BottomNavigationBarItem(icon: Icon(Icons.home), label: 'home'),
    BottomNavigationBarItem(icon: Icon(Icons.info), label: 'info'),
    BottomNavigationBarItem(icon: Icon(Icons.help), label: 'help'),
  ],
  currentIndex: view.state.index,
  onTap: (int index) => view.update((state) => ViewType.values[index]),
  type: BottomNavigationBarType.fixed,
),
```
â†’ `onTap`ã®ã¨ã“ã‚ã§å…ˆã»ã©ref.watch()ã§å–å¾—ã—ãŸStateProviderã®å€¤ã‚’æ›´æ–°ã—ã¦ã„ã¾ã™ã€‚

# ãŠã‚ã‚Š
ä»¥ä¸Šã§ã™ã€‚
ã“ã‚Œã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨ä¸Šã®æ·»ä»˜ã®ã‚ˆã†ã«ãªã‚‹ã¯ãšã§ã™ã€‚

# å‚è€ƒ
https://riverpod.dev/ja/
https://docs.flutter.dev/
